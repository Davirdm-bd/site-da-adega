<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adega Conceito</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Playfair+Display:wght@700&family=Lora:wght@400&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        .line-clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
        .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .bg-gray-750 { background-color: #374151; }
        @media print {
            .print\:hidden { display: none !important; }
            body { font-size: 12pt; color: #000; }
            .container { max-width: 100% !important; padding: 0 !important; margin: 0 !important; }
        }
        /* Estilos para o modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            padding: 1rem;
        }
        .modal-content {
            background-color: white;
            padding: 1.5rem 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            width: 100%;
            max-width: 32rem; /* max-w-lg */
            position: relative;
            display: flex;
            flex-direction: column;
            max-height: 90vh;
        }
        .modal-close-button {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            color: #6b7280; /* gray-500 */
            font-size: 1.875rem; /* text-3xl */
            line-height: 1;
            font-weight: 300; /* font-light */
            cursor: pointer;
        }
        .modal-body-scroll {
            overflow-y: auto;
            flex-grow: 1;
            margin-bottom: 1.5rem;
            padding-right: 0.5rem; /* Para compensar a scrollbar */
            margin-right: -0.5rem; /* Para compensar a scrollbar */
        }
    </style>
</head>
<body class="min-h-screen flex flex-col bg-gray-100 font-sans antialiased">

    <header class="bg-gradient-to-r from-gray-900 to-gray-700 text-white p-4 shadow-lg rounded-b-lg relative print:hidden">
        <div class="container mx-auto flex items-center justify-center relative">
            <div class="text-center">
                <h1 class="text-3xl font-bold text-yellow-400 cursor-pointer" onclick="navigateToPage('home')">Adega Conceito</h1>
            </div>
            <div class="absolute right-0 top-1/2 transform -translate-y-1/2 flex items-center space-x-2">
                <button type="button" onclick="toggleCartModal()" class="text-white focus:outline-none focus:ring-2 focus:ring-yellow-400 p-1 rounded-md flex items-center relative hover:bg-gray-600 transition-colors" aria-label="Abrir carrinho de compras">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-shopping-cart w-6 h-6">
                        <circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                    <span id="cart-item-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full h-4 w-4 flex items-center justify-center">0</span>
                </button>
                <button type="button" onclick="toggleMenu()" class="text-white focus:outline-none focus:ring-2 focus:ring-yellow-400 p-1 rounded-md hover:bg-gray-600 transition-colors" aria-label="Abrir menu de navegação">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
            <div id="main-menu" class="hidden absolute top-full right-0 mt-2 w-56 bg-gray-800 rounded-lg shadow-xl py-2 z-20">
                <button type="button" onclick="navigateToPage('home')" class="block w-full text-left px-4 py-2.5 text-white hover:bg-gray-700 transition duration-150">Home</button>
                <button type="button" onclick="navigateToPage('shop')" class="block w-full text-left px-4 py-2.5 text-white hover:bg-gray-700 transition duration-150">Loja</button>
                <button type="button" onclick="navigateToPage('about')" class="block w-full text-left px-4 py-2.5 text-white hover:bg-gray-700 transition duration-150">Sobre</button>
            </div>
        </div>
    </header>

    <main id="app-main-content" class="flex-grow py-8 w-full">
        <!-- Conteúdo da página será renderizado aqui pelo JavaScript -->
    </main>

    <footer class="bg-gray-900 text-white p-6 mt-auto rounded-t-lg print:hidden">
        <div class="container mx-auto text-center text-sm">
            <p>&copy; <span id="current-year"></span> Adega Conceito. Todos os direitos reservados.</p>
            <p class="mt-2">Desenvolvido por</p>
            <div class="flex items-center justify-center flex-wrap mt-1">
                <a href="https://www.instagram.com/davirdm_" target="_blank" rel="noopener noreferrer" class="text-white hover:text-pink-500 transition-colors duration-300 flex items-center mx-2 my-1" aria-label="Instagram de davirdm_">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="inline-block mr-1.5"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
                    davirdm_
                </a>
                <a href="https://www.facebook.com/share/1AhpwYFP5T/?mibextid=qi2Omg" target="_blank" rel="noopener noreferrer" class="text-white hover:text-blue-600 transition-colors duration-300 flex items-center mx-2 my-1" aria-label="Facebook de Davi Rebouças">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="inline-block mr-1.5"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>
                    Davi Rebouças
                </a>
            </div>
            <!-- userId não será exibido em HTML simples sem Firebase Auth -->
        </div>
    </footer>

    <!-- Modals -->
    <div id="cart-modal-overlay" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold text-gray-800">Seu Carrinho</h2>
                <button type="button" onclick="toggleCartModal()" class="modal-close-button">&times;</button>
            </div>
            <div id="cart-items-container" class="modal-body-scroll">
                <!-- Itens do carrinho serão inseridos aqui -->
            </div>
            <div id="cart-summary" class="mt-auto border-t pt-6 hidden">
                <div class="text-right mb-1">
                    <span class="text-gray-600">Subtotal: </span>
                    <span class="font-semibold text-gray-800" id="cart-subtotal">R$ 0.00</span>
                </div>
                <div class="text-right mb-1 text-sm text-red-600 hidden" id="cart-discount-row">
                    <span>Descontos (<span id="cart-applied-promos"></span>): </span>
                    <span class="font-semibold" id="cart-total-discount">- R$ 0.00</span>
                </div>
                <div class="text-right text-2xl font-bold text-gray-900 mb-6">
                    Total: <span class="text-yellow-600" id="cart-final-total">R$ 0.00</span>
                </div>
                <button type="button" onclick="handleCheckout()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:-translate-y-1">Finalizar Compra</button>
            </div>
            <p id="empty-cart-message" class="text-gray-600 text-center text-lg py-8">O seu carrinho está vazio.</p>
        </div>
    </div>

    <div id="checkout-confirm-modal-overlay" class="modal-overlay hidden">
        <div class="modal-content text-center max-w-md">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Confirmar Compra</h2>
            <p class="text-gray-700 mb-6">Ao confirmar, você será redirecionado para o WhatsApp para finalizar o seu pedido com nossa equipe.</p>
            <div class="flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4">
                <button type="button" onclick="closeCheckoutConfirmModal()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2.5 px-4 rounded-full transition duration-300 w-full sm:w-auto focus:outline-none focus:ring-2 focus:ring-gray-400">Cancelar</button>
                <button type="button" onclick="proceedToAddressCollection()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 px-4 rounded-full transition duration-300 w-full sm:w-auto focus:outline-none focus:ring-2 focus:ring-green-500">Confirmar e Ir para WhatsApp</button>
            </div>
        </div>
    </div>

    <div id="address-modal-overlay" class="modal-overlay hidden">
        <div class="modal-content text-center max-w-lg">
            <button type="button" onclick="closeAddressModal()" class="modal-close-button">&times;</button>
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Endereço de Entrega</h2>
            
            <form id="address-form" onsubmit="event.preventDefault(); handleFinalCheckoutWithAddress();" novalidate>
                <div class="space-y-4 text-left">
                    <div>
                        <label for="cep" class="block text-sm font-medium text-gray-700 mb-1">CEP</label>
                        <input type="tel" name="cep" id="cep" inputmode="numeric" autocomplete="postal-code" placeholder="00000-000" class="w-full p-3 border rounded-md focus:ring-yellow-500 focus:border-yellow-500 border-gray-300" required />
                        <p id="cep-error" class="text-red-500 text-xs mt-1 hidden">CEP inválido (ex: 00000-000).</p>
                    </div>
                    <div>
                        <label for="street" class="block text-sm font-medium text-gray-700 mb-1">Rua</label>
                        <input type="text" name="street" id="street" autocomplete="street-address" placeholder="Nome da sua rua" class="w-full p-3 border rounded-md focus:ring-yellow-500 focus:border-yellow-500 border-gray-300" required />
                        <p id="street-error" class="text-red-500 text-xs mt-1 hidden">Rua é obrigatória.</p>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="number" class="block text-sm font-medium text-gray-700 mb-1">Número</label>
                            <input type="text" name="number" id="number" inputmode="text" autocomplete="address-line2" placeholder="Ex: 123 ou S/N" class="w-full p-3 border rounded-md focus:ring-yellow-500 focus:border-yellow-500 border-gray-300" required />
                            <p id="number-error" class="text-red-500 text-xs mt-1 hidden">Número é obrigatório.</p>
                        </div>
                        <div>
                            <label for="neighborhood" class="block text-sm font-medium text-gray-700 mb-1">Bairro</label>
                            <input type="text" name="neighborhood" id="neighborhood" autocomplete="address-level2" placeholder="Nome do seu bairro" class="w-full p-3 border rounded-md focus:ring-yellow-500 focus:border-yellow-500 border-gray-300" required />
                            <p id="neighborhood-error" class="text-red-500 text-xs mt-1 hidden">Bairro é obrigatório.</p>
                        </div>
                    </div>
                </div>
                <p id="general-error" class="text-red-500 text-sm mt-4 text-center hidden"></p>
                <div class="flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4 mt-8">
                    <button type="button" onclick="closeAddressModal()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2.5 px-4 rounded-full transition duration-300 w-full sm:w-auto focus:outline-none focus:ring-2 focus:ring-gray-400">Cancelar</button>
                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 px-4 rounded-full transition duration-300 w-full sm:w-auto focus:outline-none focus:ring-2 focus:ring-green-500">Confirmar e Enviar Pedido</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const PRODUCTS = [
            {
                id: 'absolut',
                name: 'Vodka Absolut',
                price: 90.00,
                description: "Absolut é uma marca de vodka sueca, produzida em Åhus, Suécia. Conhecida por sua garrafa icônica e por sua forte ligação com a arte e a cultura, a Absolut oferece uma linha premium de vodkas puras e saborizadas, todas feitas com ingredientes naturais e sem adição de açúcar. É sinônimo de criatividade e qualidade.",
                shortDescription: "Vodka sueca premium, destilação contínua, ícone cultural...",
                image: "https://www.thetipplecellar.com/image_resize/w555/h555/products/372/71d2ekq9kvl.acsl1500-copy.jpg",
                history: "Lançada em 1879 por Lars Olsson Smith, a Absolut revolucionou a produção de vodka com o seu método de destilação contínua, removendo impurezas e mantendo o caráter dos ingredientes. A sua icónica garrafa, inspirada num frasco de remédio sueco do século XVIII encontrado numa loja de antiguidades em Estocolmo, foi introduzida em Nova Iorque em 1979. Esta estratégia de marketing inovadora, juntamente com colaborações artísticas com nomes como Andy Warhol, ajudou a Absolut a tornar-se uma marca global e um ícone cultural."
            },
            {
                id: 'smirnoff',
                name: 'Vodka Smirnoff',
                price: 50.00,
                description: "Smirnoff é uma marca de vodka russa, fundada em 1864 por Pyotr Arsenievich Smirnov. É a vodka mais vendida no mundo e é conhecida por sua pureza e versatilidade em coquetéis. A marca oferece uma vasta gama de sabores e edições especiais, tornando-a uma favorita para diversas ocasiões.",
                shortDescription: "Vodka russa mais vendida, pureza e versatilidade em cocktails...",
                image: "https://www.elpalaciodehierro.com/on/demandware.static/-/Sites-palacio-master-catalog/default/dw6c36325a/images/12654333/large/12654333_x1.jpg",
                history: "A história da Smirnoff começa em Moscovo, em 1864, quando Pyotr Arsenievich Smirnov fundou a sua destilaria. Utilizando um processo de filtração por carvão pioneiro, Smirnov criou uma uma vodka de pureza excecional que rapidamente ganhou popularidade, chegando a ser o fornecedor oficial da Corte Imperial Russa. Após a Revolução Russa, a família Smirnov fugiu do país, restabelecendo a marca em França e, posteriormente, nos Estados Unidos, onde se tornou a vodka mais vendida do mundo, popularizando cocktails como o Moscow Mule."
            },
            {
                id: 'blackWhite',
                name: 'Whisky Black White',
                price: 60.00,
                description: "Black White é um whisky escocês blended, conhecido por seu sabor suave e acessível. É uma escolha popular para quem busca um whisky de qualidade para o dia a dia ou para misturas.",
                shortDescription: "Whisky escocês suave e acessível, ideal para o dia a dia...",
                image: "https://cdn11.bigcommerce.com/s-q90i85/images/stencil/1280w/products/390/1139/blackandwhite__39875.1629546098.png?c=2",
                history: "O Whisky Black White foi criado em 1884 por James Buchanan. Originalmente conhecido como 'Buchanan's Blend', o nome 'Black & White' foi adotado devido à popularidade do seu rótulo distintivo, com um cão Terrier escocês preto e um West Highland White Terrier branco. Tornou-se um dos whiskies mais vendidos no mundo, especialmente conhecido pela sua leveza e suavidade, o que o torna ideal para ser apreciado puro ou em cocktails."
            },
            {
                id: 'ginTanqueray',
                name: 'Gin Tanqueray London Dry',
                price: 150.00,
                description: "Tanqueray é um gin inglês premium, destilado quatro vezes com uma mistura equilibrada de botânicos, incluindo zimbro, coentro, angélica e alcaçuz. Conhecido por seu sabor nítido e seco, é a base perfeita para coquetéis clássicos como o Gin Tônica, oferecendo uma experiência sofisticada e refrescante.",
                shortDescription: "Gin inglês premium, destilado quatro vezes, sabor nítido e seco...",
                image: "https://www.continente.pt/on/demandware.static/-/Sites-col-master-catalog/default/dwbe2e0a97/images/col/531/5318889-frente.jpg",
                history: "Criado por Charles Tanqueray em 1830 em Londres, o Gin Tanqueray é conhecido pela sua receita que, segundo consta, apenas quatro pessoas no mundo conhecem. A sua destilação quádrupla e a seleção de botânicos de alta qualidade, como zimbro da Toscana, coentro, raiz de angélica e alcaçuz, resultam num gin com um perfil de sabor distintamente seco e cítrico. A icónica garrafa verde, inspirada num hidrante de rua inglês, é também uma marca registada."
            },
        ];

        const PROMOTIONS = [
            {
                id: 'promoAbsolut',
                name: 'Combo Absolut Imperdível!',
                itemsRequired: [{ productId: 'absolut', quantity: 2 }],
                promotionalPriceForSet: 170.00, // 2 * R$85
                description: '2x Vodka Absolut por R$ 170,00 + 1L Energético Mormaii',
            },
            {
                id: 'promoSmirnoff',
                name: 'Esquenta Smirnoff!',
                itemsRequired: [{ productId: 'smirnoff', quantity: 2 }],
                promotionalPriceForSet: 90.00, // 2 * R$45
                description: '2x Vodka Smirnoff por R$ 90,00 + 1L Energético Mormaii',
            },
            {
                id: 'promoBlackWhite',
                name: 'Dose Dupla Black White!',
                itemsRequired: [{ productId: 'blackWhite', quantity: 2 }],
                promotionalPriceForSet: 110.00, // 2 * R$55
                description: '2x Whisky Black White por R$ 110,00 + 1L Energético Mormaii',
            },
            {
                id: 'promoGinTanqueray',
                name: 'Gin Tanqueray em Dobro!',
                itemsRequired: [{ productId: 'ginTanqueray', quantity: 2 }],
                promotionalPriceForSet: 290.00, // 2 * R$145
                description: '2x Gin Tanqueray por R$ 290,00 + 1L Energético Mormaii',
            }
        ];

        let cart = [];
        let currentPage = 'home';

        // --- Funções de Navegação e UI ---
        function navigateToPage(pageId) {
            currentPage = pageId;
            renderPage();
            closeMenu();
            closeCartModal();
            closeCheckoutConfirmModal();
            closeAddressModal();
        }

        function toggleMenu() {
            const menu = document.getElementById('main-menu');
            menu.classList.toggle('hidden');
            closeCartModal();
            closeCheckoutConfirmModal();
            closeAddressModal();
        }

        function closeMenu() {
            document.getElementById('main-menu').classList.add('hidden');
        }

        function toggleCartModal() {
            const modal = document.getElementById('cart-modal-overlay');
            modal.classList.toggle('hidden');
            if (!modal.classList.contains('hidden')) {
                renderCart();
            }
            closeMenu();
            closeCheckoutConfirmModal();
            closeAddressModal();
        }

        function closeCartModal() {
            document.getElementById('cart-modal-overlay').classList.add('hidden');
        }

        function closeCheckoutConfirmModal() {
            document.getElementById('checkout-confirm-modal-overlay').classList.add('hidden');
        }

        function closeAddressModal() {
            document.getElementById('address-modal-overlay').classList.add('hidden');
        }

        // --- Lógica do Carrinho ---
        function calculateCartTotals(currentCart) {
            let subtotal = 0;
            let totalDiscount = 0;
            let appliedPromos = [];

            let tempCartForPromoCalc = JSON.parse(JSON.stringify(currentCart));

            tempCartForPromoCalc.forEach(item => {
                const productInfo = PRODUCTS.find(p => p.id === item.id);
                if (productInfo) {
                    subtotal += productInfo.price * item.quantity;
                }
            });

            PROMOTIONS.forEach(promo => {
                let setsAppliedThisPromo = 0;
                while (true) {
                    const canApplyThisSet = promo.itemsRequired.every(reqItem => {
                        const cartItem = tempCartForPromoCalc.find(ci => ci.id === reqItem.productId);
                        return cartItem && cartItem.quantity >= reqItem.quantity;
                    });

                    if (canApplyThisSet) {
                        let originalPriceForSet = 0;
                        promo.itemsRequired.forEach(reqItem => {
                            const productDetails = PRODUCTS.find(p => p.id === reqItem.productId);
                            if (productDetails) {
                                originalPriceForSet += productDetails.price * reqItem.quantity;
                            }
                            const cartItemIndex = tempCartForPromoCalc.findIndex(ci => ci.id === reqItem.productId);
                            if (cartItemIndex > -1) {
                                tempCartForPromoCalc[cartItemIndex].quantity -= reqItem.quantity;
                            }
                        });
                        totalDiscount += (originalPriceForSet - promo.promotionalPriceForSet);
                        setsAppliedThisPromo++;
                    } else {
                        break;
                    }
                }
                if (setsAppliedThisPromo > 0) {
                    appliedPromos.push(`${promo.name} (x${setsAppliedThisPromo})`);
                }
            });

            const finalTotal = subtotal - totalDiscount;
            const appliedPromotionsText = appliedPromos.join(', ');

            return { subtotal, totalDiscount, finalTotal, appliedPromotionsText };
        }

        function updateCartCountDisplay() {
            const count = cart.reduce((total, item) => total + item.quantity, 0);
            document.getElementById('cart-item-count').textContent = count;
        }

        function addToCart(productId) {
            const product = PRODUCTS.find(p => p.id === productId);
            if (!product) return;

            const existingItemIndex = cart.findIndex(item => item.id === productId);
            if (existingItemIndex > -1) {
                cart[existingItemIndex].quantity++;
            } else {
                cart.push({ ...product, quantity: 1 });
            }
            updateCartCountDisplay();
            console.log('Carrinho:', cart);
        }

        function updateCartQuantity(productId, quantity) {
            const existingItemIndex = cart.findIndex(item => item.id === productId);
            if (existingItemIndex > -1) {
                if (quantity <= 0) {
                    removeFromCart(productId);
                } else {
                    cart[existingItemIndex].quantity = quantity;
                }
            }
            renderCart();
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            renderCart();
        }

        function renderCart() {
            const cartItemsContainer = document.getElementById('cart-items-container');
            const cartSummary = document.getElementById('cart-summary');
            const emptyCartMessage = document.getElementById('empty-cart-message');

            if (cart.length === 0) {
                cartItemsContainer.innerHTML = '';
                cartSummary.classList.add('hidden');
                emptyCartMessage.classList.remove('hidden');
                updateCartCountDisplay();
                return;
            }

            emptyCartMessage.classList.add('hidden');
            cartSummary.classList.remove('hidden');

            cartItemsContainer.innerHTML = cart.map(item => `
                <div class="flex flex-col sm:flex-row items-center justify-between border-b border-gray-200 py-4">
                    <div class="flex items-center mb-2 sm:mb-0 w-full sm:w-auto">
                        <div class="w-16 h-16 bg-gray-100 flex items-center justify-center rounded-md mr-4 overflow-hidden">
                            <img src="${item.image}" alt="${item.name}" class="max-w-full max-h-full object-contain" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/100x100/cccccc/ffffff?text=Img';" />
                        </div>
                        <div class="flex-grow">
                            <h3 class="text-lg font-semibold text-gray-800">${item.name}</h3>
                            <p class="text-gray-600">R$ ${item.price.toFixed(2)}</p>
                        </div>
                    </div>
                    <div class="flex items-center mt-2 sm:mt-0">
                        <button type="button" onclick="updateCartQuantity('${item.id}', ${item.quantity - 1})" class="bg-gray-200 text-gray-700 px-3 py-1 rounded-md hover:bg-gray-300 transition-colors" aria-label="Diminuir quantidade de ${item.name}">-</button>
                        <span class="mx-3 text-gray-800 tabular-nums">${item.quantity}</span>
                        <button type="button" onclick="updateCartQuantity('${item.id}', ${item.quantity + 1})" class="bg-gray-200 text-gray-700 px-3 py-1 rounded-md hover:bg-gray-300 transition-colors" aria-label="Aumentar quantidade de ${item.name}">+</button>
                        <button type="button" onclick="removeFromCart('${item.id}')" class="ml-4 text-red-500 hover:text-red-700 transition-colors" aria-label="Remover ${item.name} do carrinho">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2">
                                <polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line>
                            </svg>
                        </button>
                    </div>
                </div>
            `).join('');

            const totals = calculateCartTotals(cart);
            document.getElementById('cart-subtotal').textContent = `R$ ${totals.subtotal.toFixed(2)}`;
            document.getElementById('cart-total-discount').textContent = `- R$ ${totals.totalDiscount.toFixed(2)}`;
            document.getElementById('cart-applied-promos').textContent = totals.appliedPromotionsText;
            document.getElementById('cart-final-total').textContent = `R$ ${totals.finalTotal.toFixed(2)}`;

            if (totals.totalDiscount > 0) {
                document.getElementById('cart-discount-row').classList.remove('hidden');
            } else {
                document.getElementById('cart-discount-row').classList.add('hidden');
            }
            updateCartCountDisplay();
        }

        function handleCheckout() {
            closeCartModal();
            document.getElementById('checkout-confirm-modal-overlay').classList.remove('hidden');
        }

        function proceedToAddressCollection() {
            closeCheckoutConfirmModal();
            document.getElementById('address-modal-overlay').classList.remove('hidden');
            // Limpa os campos e erros do formulário ao abrir
            document.getElementById('address-form').reset();
            document.getElementById('cep-error').classList.add('hidden');
            document.getElementById('street-error').classList.add('hidden');
            document.getElementById('number-error').classList.add('hidden');
            document.getElementById('neighborhood-error').classList.add('hidden');
            document.getElementById('general-error').classList.add('hidden');
        }

        function handleFinalCheckoutWithAddress() {
            const cep = document.getElementById('cep').value;
            const street = document.getElementById('street').value;
            const number = document.getElementById('number').value;
            const neighborhood = document.getElementById('neighborhood').value;

            let hasError = false;
            const cepPattern = /^\d{5}-?\d{3}$/;

            // Reset errors
            document.getElementById('cep-error').classList.add('hidden');
            document.getElementById('street-error').classList.add('hidden');
            document.getElementById('number-error').classList.add('hidden');
            document.getElementById('neighborhood-error').classList.add('hidden');
            document.getElementById('general-error').classList.add('hidden');

            if (!cep.trim() || !cepPattern.test(cep)) {
                document.getElementById('cep-error').classList.remove('hidden');
                hasError = true;
            }
            if (!street.trim()) {
                document.getElementById('street-error').classList.remove('hidden');
                hasError = true;
            }
            if (!number.trim()) {
                document.getElementById('number-error').classList.remove('hidden');
                hasError = true;
            }
            if (!neighborhood.trim()) {
                document.getElementById('neighborhood-error').classList.remove('hidden');
                hasError = true;
            }

            if (hasError) {
                document.getElementById('general-error').textContent = "Por favor, preencha todos os campos obrigatórios corretamente.";
                document.getElementById('general-error').classList.remove('hidden');
                return;
            }

            const phoneNumber = '5584988454446';
            const totals = calculateCartTotals(cart);

            let message = "Olá! Gostaria de finalizar a minha compra na Adega Conceito.\n\n";
            message += "Itens:\n";
            cart.forEach(item => {
                message += `- ${item.name} (x${item.quantity}) - R$ ${(item.price * item.quantity).toFixed(2)}\n`;
            });
            message += `\nSubtotal: R$ ${totals.subtotal.toFixed(2)}\n`;
            if (totals.totalDiscount > 0) {
                message += `Descontos (${totals.appliedPromotionsText}): - R$ ${totals.totalDiscount.toFixed(2)}\n`;
            }
            message += `Total: R$ ${totals.finalTotal.toFixed(2)}\n`;

            message += "\nEndereço para entrega:\n";
            message += `CEP: ${cep}\n`;
            message += `Rua: ${street}\n`;
            message += `Número: ${number}\n`;
            message += `Bairro: ${neighborhood}\n`;
            message += "\nAguardamos o seu contato para finalizar o pedido!";

            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;

            window.open(whatsappUrl, '_blank');

            cart = []; // Limpa o carrinho
            closeAddressModal();
            updateCartCountDisplay(); // Atualiza o contador do carrinho no header
            navigateToPage('home'); // Volta para a página inicial
        }

        // --- Funções de Renderização de Páginas ---
        function renderHomePage() {
            const mainContent = document.getElementById('app-main-content');
            const featuredProducts = PRODUCTS.filter(p => ['absolut', 'smirnoff', 'blackWhite', 'ginTanqueray'].includes(p.id))
                                            .sort((a, b) => ['absolut', 'smirnoff', 'blackWhite', 'ginTanqueray'].indexOf(a.id) - ['absolut', 'smirnoff', 'blackWhite', 'ginTanqueray'].indexOf(b.id))
                                            .slice(0, 4);

            mainContent.innerHTML = `
                <div class="container mx-auto px-4 py-8 text-center">
                    <div class="bg-white p-8 rounded-lg shadow-xl mb-8">
                        <h2 class="text-4xl sm:text-5xl font-extrabold text-gray-800 mb-6 leading-tight">
                            Bem-vindo à <span class="text-yellow-600">Adega Conceito</span>
                        </h2>
                        <p class="text-lg text-gray-600 mb-10 max-w-2xl mx-auto">
                            Explore a sofisticação e a qualidade dos melhores destilados do mercado.
                            Descubra a história, os sabores e as possibilidades infinitas.
                        </p>

                        <h3 class="text-3xl font-bold text-gray-700 mb-8 mt-12">Em Destaque</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8">
                            ${featuredProducts.map(product => `
                                <div class="bg-white rounded-lg shadow-xl overflow-hidden transform hover:scale-105 transition duration-300 ease-in-out flex flex-col h-full">
                                    <div class="w-full h-64 bg-gray-100 flex items-center justify-center overflow-hidden cursor-pointer" onclick="navigateToPage('${product.id}')">
                                        <img src="${product.image}" alt="${product.name}" class="max-w-full max-h-full object-contain" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/ffffff?text=Imagem+Indisponível';" />
                                    </div>
                                    <div class="p-6 flex flex-col flex-grow">
                                        <h3 class="text-xl md:text-2xl font-bold text-gray-800 mb-2 cursor-pointer hover:text-yellow-600" onclick="navigateToPage('${product.id}')">
                                            ${product.name}
                                        </h3>
                                        <p class="text-gray-600 text-sm mb-4 line-clamp-2 flex-grow">${product.shortDescription}</p>
                                        <!-- Preço não exibido na Home Page conforme a versão React anterior -->
                                        <button type="button" onclick="addToCart('${product.id}')" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:-translate-y-1 mt-auto">
                                            Adicionar ao Carrinho
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderShopPage() {
            const mainContent = document.getElementById('app-main-content');
            mainContent.innerHTML = `
                <div class="container mx-auto px-4 py-8">
                    <h2 class="text-4xl sm:text-5xl font-extrabold text-gray-800 mb-10 text-center">Nossos Produtos</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                        ${PRODUCTS.map(product => `
                            <div class="bg-white rounded-lg shadow-xl overflow-hidden transform hover:scale-105 transition duration-300 ease-in-out flex flex-col h-full">
                                <div class="w-full h-64 bg-gray-100 flex items-center justify-center overflow-hidden">
                                    <img src="${product.image}" alt="${product.name}" class="max-w-full max-h-full object-contain" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/ffffff?text=Imagem+Indisponível';" />
                                </div>
                                <div class="p-6 flex flex-col flex-grow">
                                    <h3 class="text-xl md:text-2xl font-bold text-gray-800 mb-2">${product.name}</h3>
                                    <p class="text-gray-600 text-sm mb-4 line-clamp-3 flex-grow">${product.description}</p>
                                    <p class="text-2xl md:text-3xl font-bold text-yellow-600 mb-4 mt-auto">R$ ${product.price.toFixed(2)}</p>
                                    <button type="button" onclick="addToCart('${product.id}')" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:-translate-y-1 mt-auto">
                                        Adicionar ao Carrinho
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderProductDetailPage(productId) {
            const product = PRODUCTS.find(p => p.id === productId);
            if (!product) {
                document.getElementById('app-main-content').innerHTML = `
                    <div class="container mx-auto px-4 py-8 text-center">
                        <p class="text-gray-700 text-lg">Produto não encontrado ou informações indisponíveis.</p>
                    </div>
                `;
                return;
            }

            const isImageLeft = ['absolut', 'ginTanqueray', 'blackWhite'].includes(productId);
            document.getElementById('app-main-content').innerHTML = `
                <div class="container mx-auto px-4 py-8">
                    <div class="bg-white p-6 md:p-8 rounded-lg shadow-xl flex flex-col md:flex-row items-start md:items-center gap-8">
                        <div class="w-full md:w-1/2 max-w-md rounded-lg shadow-md flex items-center justify-center bg-gray-100 p-4 ${isImageLeft ? 'md:order-1' : 'md:order-2'}">
                            <img src="${product.image}" alt="${product.name}" class="max-w-full max-h-[400px] object-contain transform hover:scale-105 transition duration-300 ease-in-out" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/600x600/cccccc/ffffff?text=Imagem+Indisponível';" />
                        </div>
                        <div class="md:w-1/2 text-center md:text-left ${isImageLeft ? 'md:order-2' : 'md:order-1'}">
                            <h2 class="text-3xl lg:text-4xl font-extrabold text-gray-800 mb-4">${product.name}</h2>
                            <p class="text-lg text-gray-700 leading-relaxed mb-4">${product.description}</p>
                            <p class="text-3xl font-bold text-yellow-600 mt-4">R$ ${product.price.toFixed(2)}</p>
                            <div class="mt-6 flex flex-col sm:flex-row gap-3">
                                <button type="button" onclick="addToCart('${product.id}')" class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-opacity-50 flex-1">
                                    Adicionar ao Carrinho
                                </button>
                                <!-- Botão de ideias de cocktails removido para simplificação em HTML puro -->
                            </div>
                        </div>
                    </div>
                    ${product.history ? `
                    <div class="bg-white p-6 md:p-8 rounded-lg shadow-xl mt-8">
                        <h3 class="text-2xl font-semibold text-gray-700 mb-3 border-b pb-2">História do Produto</h3>
                        <p class="text-md text-gray-600 leading-relaxed whitespace-pre-line">${product.history}</p>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        function renderAboutPage() {
            const mainContent = document.getElementById('app-main-content');
            mainContent.innerHTML = `
                <div class="container mx-auto px-4 py-8 text-center">
                    <div class="bg-white p-8 rounded-lg shadow-xl max-w-4xl mx-auto">
                        <h2 class="text-4xl font-bold text-gray-800 mb-6" style="font-family: 'Playfair Display', serif;">Sobre a Adega Conceito</h2>
                        <p class="text-lg text-gray-700 leading-relaxed mb-4" style="font-family: 'Lora', serif;">A Adega Conceito nasceu da paixão por destilados de alta qualidade e do desejo de proporcionar uma experiência única aos apreciadores. O nosso objetivo é curar uma seleção exclusiva das melhores bebidas do mercado, oferecendo não apenas produtos, mas também conhecimento e inspiração para cada gole.</p>
                        <p class="text-lg text-gray-700 leading-relaxed mb-4" style="font-family: 'Lora', serif;">Acreditamos que cada garrafa conta uma história, e estamos aqui para o ajudar a descobrir a sua. Trabalhamos com marcas renomadas como Absolut, Smirnoff e Tanqueray, garantindo a excelência em cada produto que oferecemos.</p>
                    </div>
                </div>
            `;
        }

        function renderPage() {
            switch (currentPage) {
                case 'home':
                    renderHomePage();
                    break;
                case 'shop':
                    renderShopPage();
                    break;
                case 'absolut':
                case 'smirnoff':
                case 'blackWhite':
                case 'ginTanqueray':
                    renderProductDetailPage(currentPage);
                    break;
                case 'about':
                    renderAboutPage();
                    break;
                default:
                    renderHomePage();
            }
        }

        // --- Inicialização ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('current-year').textContent = new Date().getFullYear();
            renderPage(); // Renderiza a página inicial ao carregar
            updateCartCountDisplay(); // Atualiza o contador do carrinho
        });
    </script>
</body>
</html>
